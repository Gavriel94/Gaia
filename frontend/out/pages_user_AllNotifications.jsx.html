<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/user/AllNotifications.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/user/AllNotifications.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from 'react'
import { useStateContext } from '../../context/ContextProvider'
import API from '../../API'
import { Header, Title, SidebarV2, Button } from '../../components'
import { BsEnvelope, BsEnvelopeOpen } from 'react-icons/bs'
import { MdDeleteForever } from 'react-icons/md'
import { Navigate } from 'react-router-dom'

/**
 * 
 * Page containing a clickable list of all user notifications
 */

const Notifications = () => {

  const { loggedInProfile, darkMode } = useStateContext()
  const [notifications, setNotifications] = useState([])
  const [loggedIn, setLoggedIn] = useState(undefined)
  const [commentID, setCommentID] = useState('')
  const [viewComment, setViewComment] = useState(false)
  const [notificationDeleted, setNotificationDeleted] = useState(false)


  useEffect(() => {
    const getAllNotifications = async () => {

      setNotificationDeleted(false)

      if (loggedInProfile.sessionToken === '') {
        setLoggedIn(false)
        return
      } else {
        setLoggedIn(true)
      }

      await API.get(`profile/notification/all/${loggedInProfile.id}`, {
        headers: {
          'Authorization': `Token ${loggedInProfile.sessionToken}`,
          'Content-Type': 'multipart/form-data',
        },
      }).then((res) => {
        setNotifications(res.data.reverse())
      })
        .catch(err => {
          console.log(err)
        })
    }

    getAllNotifications()
  }, [notificationDeleted])

  const readIcon = (readStatus) => {
    if (readStatus === '0') {
      return (
        &lt;BsEnvelope size={'26px'} color={`${darkMode ? 'white' : 'black'}`} />
      )
    } else {
      return (
        &lt;BsEnvelopeOpen size={'26px'} color={`${darkMode ? 'white' : 'black'}`} />
      )
    }
  }

  const viewCommentDetail = async (commentID, notificationID) => {
    let readNotif = new FormData()
    readNotif.append('is_read', 1)

    await API.patch(`profile/notification/read/${notificationID}/`, readNotif, {
      headers: {
        'Authorization': `Token ${loggedInProfile.sessionToken}`,
        'Content-Type': 'multipart/form-data',
      },
    }).then((res) => {
      setCommentID(commentID)
      setViewComment(true)
    }).catch(console.err)
  }

  const deleteNotification = async (notificationID) => {
    await API.delete(`profile/notification/delete/${notificationID}`, {
      headers: {
        'Authorization': `Token ${loggedInProfile.sessionToken}`,
        'Content-Type': 'multipart/form-data',
      },
    }).then((res) => {
      setNotificationDeleted(true)
    }).catch(console.err)
  }

  const displayNotifications = () => {
    if (notifications.length &lt; 1) {
      return (
        &lt;div className='text-center dark:text-white'>
          No notifications
        &lt;/div>
      )
    }

    const sliceStr = (string) => {
      if (string.length > 19) {
          return string.slice(0, 19) + '...'
      }
      else {
          return string
      }
  }

    return (
      notifications.map((notification) => (
        &lt;div className='flex flex-row space-x-5'>
          &lt;button
            className='w-full rounded-xl mt-5'
            type="button"
            onClick={() => viewCommentDetail(notification.message.id, notification.id)}
          >
            &lt;div className={`${notification.is_read === "0" ? 'bg-light-orange-hover dark:bg-dark-orange-hover' : 'bg-white dark:bg-dark-grey'} border-light-orange dark:border-dark-orange rounded-lg w-72`}>
              &lt;div className='grid grid-cols-4 gap-6'>
                &lt;div>
                  &lt;img src={notification.message.sender.profile_image} width={'50'} alt={'sender profile'} />
                &lt;/div>
                &lt;div className='mt-2 font-bold'>
                  {sliceStr(notification.message.sender.profile_name)}
                &lt;/div>
                &lt;div className='mt-2 col-start-3 col-end-6'>
                  {sliceStr(notification.message.comment)}
                &lt;/div>
              &lt;/div>
            &lt;/div>
          &lt;/button>
          &lt;div className='mt-10'>
            &lt;Button icon={&lt;MdDeleteForever size={'26px'} />} func={() => deleteNotification(notification.id)} />
          &lt;/div>
        &lt;/div>

      ))
    )
  }

  return (
    &lt;>
      &lt;div>
        &lt;Header page={'login'} />
        &lt;SidebarV2 />
        &lt;div className='flex justify-center mt-20'>
          &lt;Title text={'Notifications'} size={'text-6xl'} hover={true} />
        &lt;/div>
        &lt;div className='justify-center mt-20 m-auto w-[350px]'>
          {displayNotifications()}
        &lt;/div>
      &lt;/div>
      {
        viewComment &amp;&amp; (
          &lt;Navigate to={`/articles/comments/${commentID}`} replace={true} />
        )
      }
    &lt;/>
  )
}

export default Notifications</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="module.html#.exports">exports</a></li></ul><h3>Global</h3><ul><li><a href="global.html#About">About</a></li><li><a href="global.html#AlreadySaidAlert">AlreadySaidAlert</a></li><li><a href="global.html#App">App</a></li><li><a href="global.html#ArticleDetail">ArticleDetail</a></li><li><a href="global.html#ArticleGuide">ArticleGuide</a></li><li><a href="global.html#ArticleGuideBar">ArticleGuideBar</a></li><li><a href="global.html#ArticleList">ArticleList</a></li><li><a href="global.html#ArticleLoading">ArticleLoading</a></li><li><a href="global.html#ArticlesWritten">ArticlesWritten</a></li><li><a href="global.html#AuthorBar">AuthorBar</a></li><li><a href="global.html#BookmarkButton">BookmarkButton</a></li><li><a href="global.html#Button">Button</a></li><li><a href="global.html#CommentSection">CommentSection</a></li><li><a href="global.html#CommentThread">CommentThread</a></li><li><a href="global.html#CreateArticle">CreateArticle</a></li><li><a href="global.html#CreateArticleV2">CreateArticleV2</a></li><li><a href="global.html#DisplayComment">DisplayComment</a></li><li><a href="global.html#EditProfile">EditProfile</a></li><li><a href="global.html#EmptyFieldAlert">EmptyFieldAlert</a></li><li><a href="global.html#ExceedsLengthAlert">ExceedsLengthAlert</a></li><li><a href="global.html#FlipCard">FlipCard</a></li><li><a href="global.html#Footer">Footer</a></li><li><a href="global.html#Header">Header</a></li><li><a href="global.html#Home">Home</a></li><li><a href="global.html#ImageTooLargeAlert">ImageTooLargeAlert</a></li><li><a href="global.html#InputArea">InputArea</a></li><li><a href="global.html#InputField">InputField</a></li><li><a href="global.html#InputTooShortAlert">InputTooShortAlert</a></li><li><a href="global.html#Landing">Landing</a></li><li><a href="global.html#LandingPageVideo">LandingPageVideo</a></li><li><a href="global.html#LoadingSpinner">LoadingSpinner</a></li><li><a href="global.html#Login">Login</a></li><li><a href="global.html#LoginAlert">LoginAlert</a></li><li><a href="global.html#LoginButton">LoginButton</a></li><li><a href="global.html#LoginErrorAlert">LoginErrorAlert</a></li><li><a href="global.html#LogoutButton">LogoutButton</a></li><li><a href="global.html#Market">Market</a></li><li><a href="global.html#MenuBar">MenuBar</a></li><li><a href="global.html#MiniArticle">MiniArticle</a></li><li><a href="global.html#NotImageAlert">NotImageAlert</a></li><li><a href="global.html#NotificationButton">NotificationButton</a></li><li><a href="global.html#Notifications">Notifications</a></li><li><a href="global.html#ProfileArticleBar">ProfileArticleBar</a></li><li><a href="global.html#Profiles">Profiles</a></li><li><a href="global.html#RefreshArticles">RefreshArticles</a></li><li><a href="global.html#SentimentIndicator">SentimentIndicator</a></li><li><a href="global.html#Sidebar">Sidebar</a></li><li><a href="global.html#SidebarV2">SidebarV2</a></li><li><a href="global.html#SortingButton">SortingButton</a></li><li><a href="global.html#StateContext">StateContext</a></li><li><a href="global.html#TagIcon">TagIcon</a></li><li><a href="global.html#TagNavigation">TagNavigation</a></li><li><a href="global.html#TipButton">TipButton</a></li><li><a href="global.html#Title">Title</a></li><li><a href="global.html#TopLoader">TopLoader</a></li><li><a href="global.html#TrendBar">TrendBar</a></li><li><a href="global.html#TrendCard">TrendCard</a></li><li><a href="global.html#Trending">Trending</a></li><li><a href="global.html#UnresolvedPath">UnresolvedPath</a></li><li><a href="global.html#UserProfile">UserProfile</a></li><li><a href="global.html#UsernameLogin">UsernameLogin</a></li><li><a href="global.html#UsernameUserRegister">UsernameUserRegister</a></li><li><a href="global.html#WalletInstructions">WalletInstructions</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Tue Apr 25 2023 22:51:07 GMT+0100 (British Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
